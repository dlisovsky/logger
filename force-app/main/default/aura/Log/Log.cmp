<aura:component>
    <aura:attribute name="log" type="Map" access="public"/>
    <aura:attribute name="rootMetadata" type="Map" default="{}" access="public"/>

    <aura:attribute name="metadata" type="Map" access="private"/>
    <aura:attribute name="metadataPrettyStr" type="String" access="private"/>
    <aura:attribute name="logItems" type="List" access="private"/>
    <aura:attribute name="countByTypes" type="List" access="private"/>
    <aura:attribute name="createdOnStr" type="String" access="private"/>
    <aura:attribute name="createdOn" type="Date" access="private"/>

    <aura:handler name="init" value="{!this}" action="{!c.handleInit}"/>

    <c:Section>

        <aura:set attribute="customTitle">
            <!--<span>Log</span>-->
            <!--<span>Date: {! v.createdOnStr }</span>-->
            <!--<lightning:formattedDateTime value="{! v.log.CreatedDate }" />-->
            <!--&nbsp;-->
            <!--<lightning:formattedDateTime value="{! v.log.CreatedDate }" year="numeric" month="numeric" day="numeric"  hour="2-digit" minute="2-digit" />-->
            <lightning:relativeDateTime title="{! v.createdOnStr }" value="{! v.createdOn }"/>

            <div class="slds-float--right">

                <aura:if isTrue="{! and(v.rootMetadata, v.rootMetadata.currentUserId != v.metadata.user.Id) }">
					<span class="slds-m-right--medium" title="{! 'Logged By: ' + v.metadata.user.Name }">
						<a href="{! '/' + v.metadata.user.Id }" target="_blank">
							<lightning:icon size="small" iconName="utility:user"/>
						</a>
                        <!--{! v.metadata.user.Name }-->
					</span>
                </aura:if>

                <aura:iteration items="{!v.countByTypes}" var="countVar">
                    <aura:if isTrue="{! and(countVar.count, countVar.count > 0) }">
                        <lightning:badge label="{! countVar.type + ': ' + countVar.count }"
                                         class="{! countVar.class + ' count-by-type slds-m-left--medium' }"/>
                    </aura:if>
                </aura:iteration>
            </div>
        </aura:set>

        <!--<div style="width: 100%">-->
        <!--<pre>-->
        <!--{!v.metadataPrettyStr}-->
        <!--</pre>-->
        <!--</div>-->

        <table class="slds-table slds-table--fixed-layout slds-table_bordered">
            <tbody>
            <aura:iteration items="{! v.logItems }" var="logItem">
                <tr>
                    <td width="60px">

                        <aura:if isTrue="{#logItem.type == 'DEBUG'}">
                            <lightning:icon iconName="utility:apex"
                                            size="medium"
                                            title="DEBUG"/>
                        </aura:if>

                        <aura:if isTrue="{#logItem.type == 'INFO'}">
                            <lightning:icon iconName="utility:info"
                                            size="medium"
                                            variant="warning"
                                            title="INFO"/>
                        </aura:if>

                        <aura:if isTrue="{#logItem.type == 'ERROR'}">
                            <lightning:icon iconName="utility:error"
                                            size="medium"
                                            variant="error"
                                            title="ERROR"/>
                        </aura:if>

                        <aura:if isTrue="{#logItem.type == 'EXCEPTION'}">
                            <lightning:icon iconName="utility:clear"
                                            size="medium"
                                            variant="error"
                                            title="EXCEPTION"/>
                        </aura:if>

                    </td>
                    <td>
                        <div class="slds-truncate" title="{#logItem.message}">
                            <!--<a href="#">{#logItem.message}</a>-->
                            <!--<br/>-->
                            <!--<lightning:textarea readonly="true" value="{#logItem.message}" />-->
                            {#logItem.message}
                        </div>
                    </td>
                </tr>
            </aura:iteration>
            </tbody>
        </table>
    </c:Section>

    <!--<div class="slds-section slds-is-open">-->
    <!--<h3 class="slds-section__title">-->
    <!--<button aria-controls="expando-unique-id" aria-expanded="true" class="slds-button slds-section__title-action">-->
    <!--<lightning:icon iconName="utility:switch" size="small" class="slds-m-right&#45;&#45;medium"/>-->
    <!--<span class="slds-truncate" title="Section Title">Section Title</span>-->
    <!--</button>-->
    <!--</h3>-->
    <!--<div aria-hidden="false" class="slds-section__content" id="expando-unique-id">-->
    <!---->
    <!--</div>-->
    <!--</div>-->


</aura:component>